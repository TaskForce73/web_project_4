!function(){"use strict";var e={730:function(e,t,s){e.exports=s.p+"2f8a4cd99a9a7a10b10b.png"},14:function(e,t,s){e.exports=s.p+"4e8e0a1d604782a0dff8.svg"}},t={};function s(n){var r=t[n];if(void 0!==r)return r.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,s),i.exports}s.p="",function(){function e(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class t{constructor(t,s,n){let{data:r,handleCardClick:i,handleDeleteButton:o,handleLikeButton:l}=t;e(this,"_getTemplate",(()=>(this._element=document.querySelector(this._cardSelector).content.querySelector(".element").cloneNode(!0),this._element))),e(this,"removeCard",(()=>{this._element.remove(),this._element=null})),e(this,"_setEventListeners",(()=>{this._elementBin=this._element.querySelector(".element__bin"),this._elementBin.addEventListener("click",(()=>{this._handleDeleteButton(this._id)})),this._likeButton=this._element.querySelector(".element__button"),this._likeButton.addEventListener("click",(()=>{this._handleLikeButton(this._id)})),this._elementPicture.addEventListener("click",(()=>{this._handleCardClick(this._name,this._link)}))})),e(this,"generateCard",(()=>(this._element=this._getTemplate(),this._likeButton=this._element.querySelector(".element__button"),this._elementPicture=this._element.querySelector(".element__picture"),this._setEventListeners(),this._elementPicture.src=this._link,this._elementPicture.alt="Photo of ".concat(this._name),this._element.querySelector(".element__header").textContent=this._name,this._ownerId!==this._userId&&(this._elementBin=this._element.querySelector(".element__bin").style.display="none"),this._element.querySelector(".element__button-counter").textContent=this._likes.length,this.isLiked&&this.likeCard(this._likes),this._element))),this._name=r.name,this._link=r.link,this._cardSelector=n,this._handleCardClick=i,this._handleDeleteButton=o,this._handleLikeButton=l,this._id=r._id,this._ownerId=r.owner._id,this._userId=s,this._likes=r.likes}likeCard(e){this._likes=e,this._element.querySelector(".element__button-counter").textContent=this._likes.length,this._element.querySelector(".element__button").classList.toggle("element__button_active")}isLiked(){return this._likes.some((e=>e._id===this._userId))}}function n(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class r{constructor(e){n(this,"close",(()=>{this._popup.classList.remove("popup_open"),document.removeEventListener("keydown",this._handleEscapeClose)})),n(this,"_handleEscapeClose",(e=>{"Escape"===e.key&&this.close()})),this._popup=document.querySelector(e)}open(){this._popup.classList.add("popup_open"),document.addEventListener("keydown",this._handleEscapeClose)}setEventListeners(){this._popup.addEventListener("mousedown",(e=>{(e.target.classList.contains("popup_open")||e.target.classList.contains("popup__close"))&&this.close()}))}}class i extends r{constructor(e,t){super(e),this._handleSubmit=t,this._form=this._popup.querySelector(".popup__form")}_getInputValues(){const e={};return[...this._form.querySelectorAll(".popup__input")].forEach((t=>{e[t.name]=t.value})),e}setEventListeners(){this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleSubmit(this._getInputValues()),this.close()})),super.setEventListeners()}close(){this._form.reset(),super.close()}}class o{constructor(e,t){let{items:s,renderer:n}=e;this._items=s,this._renderer=n,this._container=document.querySelector(t)}addItem(e){this._container.prepend(e)}render(){this._items.forEach((e=>{this._renderer(e)}))}}function l(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class a{constructor(e,t){l(this,"_showInputError",(e=>{this._errorElement=this._formElement.querySelector(".".concat(e.id,"-error")),e.classList.add(this._inputErrorClass),this._errorElement.textContent=e.validationMessage,this._errorElement.classList.add(this._errorClass)})),l(this,"_hideInputError",(e=>{this._errorElement=this._formElement.querySelector(".".concat(e.id,"-error")),e.classList.remove(this._inputErrorClass),this._errorElement.classList.remove(this._errorClass),this._errorElement.textContent=""})),l(this,"_checkInputValidity",(e=>{e.validity.valid?this._hideInputError(e):this._showInputError(e)})),l(this,"_hasInvalidInput",(e=>Array.from(e).some((e=>!e.validity.valid)))),l(this,"_toggleButtonState",(()=>{this._hasInvalidInput(this._inputsList)?(this._elementButton.classList.add(this._inactiveButtonClass),this._elementButton.setAttribute("disabled",!0)):(this._elementButton.classList.remove(this._inactiveButtonClass),this._elementButton.removeAttribute("disabled"))})),l(this,"_setEventListeners",(()=>{this._inputsList=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._toggleButtonState(),this._inputsList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))})),l(this,"enableValidation",(()=>{this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()})),l(this,"resetValidation",(()=>{this._inputsList.forEach((e=>{this._hideInputError(e)})),this._toggleButtonState()})),this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._formElement=t,this._elementButton=this._formElement.querySelector(this._submitButtonSelector)}}const u={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},_=(e,t)=>fetch(e,t).then((e=>e.ok?e.json():Promise.reject(e.statusText))).catch(console.log),c=new class{constructor(e){let{baseUrl:t,headers:s}=e;this._baseUrl=t,this._headers=s}getInitialCards(){return _("".concat(this._baseUrl,"/cards"),{headers:this._headers})}getUserInfo(){return _("".concat(this._baseUrl,"/users/me"),{headers:this._headers})}createCard(e){let{name:t,link:s}=e;return _("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:s})})}deleteCard(e){return _("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers})}likeCard(e){return _("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:this._headers})}dislikeCard(e){return _("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:this._headers})}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"32b9efa0-6f35-4afe-975e-e3a6be43cfcb","Content-Type":"application/json"}});var h=s(14),d=s(730);const p=document.querySelector(".profile__plus"),m=document.querySelector(".popup__form"),f=document.querySelector(".profile__edit"),b=document.querySelector(".popup__form_second"),v=document.querySelector(".elements__list"),E=document.querySelector(".popup__input-name"),C=document.querySelector(".popup__input-about");let S;document.getElementById("around-the-us").src=h,document.getElementById("profile-image").src=d;const k=new a(u,b);k.enableValidation();const y=new a(u,m);y.enableValidation();const L=new class extends r{setAction(e){this._submitHandler=e,this._form=this._popup.querySelector(".popup__form")}_getInputValues(){const e={};return[...this._form.querySelectorAll(".popup__input")].forEach((t=>{e[t.name]=t.value})),e}setEventListeners(){this._popup.addEventListener("submit",(e=>{e.preventDefault(),this._submitHandler(this._getInputValues()),this.close()})),super.setEventListeners()}}(".popup_card_remover");L.setEventListeners();const g=new class extends r{open(e,t){const s=this._popup.querySelector(".popup__image");this._popup.querySelector(".popup__description").textContent=e,s.alt="Photo of ".concat(e),s.src=t,super.open()}}(".popup_big_image");g.setEventListeners();const B=new i(".popup_profile_adder",(e=>{w.setUserInfo(e)}));B.setEventListeners();const q=new i(".popup_card_publisher",(e=>{c.createCard({name:e.description,link:e.link}).then((e=>{I(e)}))}));q.setEventListeners();const I=e=>{const s=function(e){const s=new t({data:e,handleCardClick:(e,t)=>{g.open(e,t)},handleDeleteButton:e=>{L.open(),L.setAction((()=>{c.deleteCard(e).then((e=>{console.log("This card was deleted",e),s.removeCard()}))}))},handleLikeButton:e=>{s.isLiked()?c.dislikeCard(e).then((e=>{s.likeCard(e.likes)})):c.likeCard(e).then((e=>{s.likeCard(e.likes)}))}},S,"#card-template");return s.generateCard()}(e);v.prepend(s)};c.getUserInfo().then((e=>{S=e._id,w.setUserInfo({name:e.name,about:e.about})})),c.getInitialCards().then((e=>{console.log("res",e),new o({items:e,renderer:I},".elements__list").render()}));const w=new class{constructor(e){let{profileNameSelector:t,profileJobSelector:s}=e;this._profileName=document.querySelector(t),this._profileJob=document.querySelector(s)}getUserInfo(){return{name:this._profileName.textContent,job:this._profileJob.textContent}}setUserInfo(e){let{name:t,about:s}=e;this._profileName.textContent=t,this._profileJob.textContent=s}}({profileNameSelector:".profile__author",profileJobSelector:".profile__text"});f.addEventListener("click",(()=>{y.resetValidation(m),function(){const e=w.getUserInfo();E.value=e.name,C.value=e.job}(),B.open()})),p.addEventListener("click",(()=>{k.resetValidation(b),q.open()}))}()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q2hDL0IsS0FBSzhLLFlBQVl4SixZQUFjb0osSUg2REwsQ0FDNUJDLG9CQUFxQixtQkFDckJDLG1CQUFvQixtQkE4Q3RCN0IsRUFBa0J0SSxpQkFBaUIsU0FBUyxLQUMxQ2dKLEVBQXFCdUIsZ0JBQWdCbEMsR0FQdkMsV0FDRSxNQUFNbUMsRUFBV2hCLEVBQVM5QixjQUMxQmUsRUFBaUJuRixNQUFRa0gsRUFBU2xKLEtBQ2xDb0gsRUFBa0JwRixNQUFRa0gsRUFBU0YsSUFLbkNHLEdBQ0FsQixFQUFVaEgsVUFHWjZGLEVBQWtCcEksaUJBQWlCLFNBQVMsS0FDMUM4SSxFQUFrQnlCLGdCQUFnQmhDLEdBQ2xDbUIsRUFBYW5ILFUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80L3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvd2VicGFjay9ydW50aW1lL3B1YmxpY1BhdGgiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9zY3JpcHRzL2NvbXBvbmVudHMvQ2FyZC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdHMvY29tcG9uZW50cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdHMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvc2NyaXB0cy9jb21wb25lbnRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9zY3JpcHRzL2NvbXBvbmVudHMvRnJvbVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdHMvdXRpbHMvY29uc3RhbnRzLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvc2NyaXB0cy9jb21wb25lbnRzL0FwaS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3BhZ2VzL2luZGV4LmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvc2NyaXB0cy9jb21wb25lbnRzL1BvcHVwV2l0aFN1Ym1pdC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdHMvY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdHMvY29tcG9uZW50cy9Vc2VySW5mby5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiX193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjsiLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBDYXJkIHtcbiAgY29uc3RydWN0b3Ioe2RhdGEsIGhhbmRsZUNhcmRDbGljaywgaGFuZGxlRGVsZXRlQnV0dG9uLCBoYW5kbGVMaWtlQnV0dG9ufSwgdXNlcklkLCBjYXJkU2VsZWN0b3IpIHtcbiAgICB0aGlzLl9uYW1lID0gZGF0YS5uYW1lO1xuICAgIHRoaXMuX2xpbmsgPSBkYXRhLmxpbms7XG4gICAgdGhpcy5fY2FyZFNlbGVjdG9yID0gY2FyZFNlbGVjdG9yO1xuICAgIHRoaXMuX2hhbmRsZUNhcmRDbGljayA9IGhhbmRsZUNhcmRDbGljaztcbiAgICB0aGlzLl9oYW5kbGVEZWxldGVCdXR0b24gPSBoYW5kbGVEZWxldGVCdXR0b247XG4gICAgdGhpcy5faGFuZGxlTGlrZUJ1dHRvbiA9IGhhbmRsZUxpa2VCdXR0b247XG4gICAgdGhpcy5faWQgPSBkYXRhLl9pZDtcbiAgICB0aGlzLl9vd25lcklkID0gZGF0YS5vd25lci5faWQ7XG4gICAgdGhpcy5fdXNlcklkID0gdXNlcklkO1xuICAgIHRoaXMuX2xpa2VzID0gZGF0YS5saWtlcztcbiAgfVxuXG4gIF9nZXRUZW1wbGF0ZSA9ICgpID0+IHtcbiAgICB0aGlzLl9lbGVtZW50ID0gZG9jdW1lbnRcbiAgICAgIC5xdWVyeVNlbGVjdG9yKHRoaXMuX2NhcmRTZWxlY3RvcilcbiAgICAgIC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudFwiKVxuICAgICAgLmNsb25lTm9kZSh0cnVlKTtcbiAgICByZXR1cm4gdGhpcy5fZWxlbWVudDtcbiAgfTtcblxuICByZW1vdmVDYXJkID0gKCkgPT4ge1xuICAgIGNvbnN0IGNhcmQgPSB0aGlzLl9lbGVtZW50O1xuICAgIGNhcmQucmVtb3ZlKCk7XG4gICAgdGhpcy5fZWxlbWVudCA9IG51bGw7XG4gIH07XG5cbiBsaWtlQ2FyZChuZXdMaWtlcykge1xuICAgdGhpcy5fbGlrZXMgPSBuZXdMaWtlc1xuICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRfX2J1dHRvbi1jb3VudGVyXCIpLnRleHRDb250ZW50ID0gdGhpcy5fbGlrZXMubGVuZ3RoO1xuICB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudF9fYnV0dG9uXCIpLmNsYXNzTGlzdC50b2dnbGUoXCJlbGVtZW50X19idXR0b25fYWN0aXZlXCIpO1xuICB9O1xuXG4gIGlzTGlrZWQoKSB7XG5yZXR1cm4gdGhpcy5fbGlrZXMuc29tZSgocGVyc29uKSA9PiBwZXJzb24uX2lkID09PSB0aGlzLl91c2VySWQpXG4gIH1cblxuICBfc2V0RXZlbnRMaXN0ZW5lcnMgPSAoKSA9PiB7XG4gICAgdGhpcy5fZWxlbWVudEJpbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X19iaW5cIik7XG4gICAgdGhpcy5fZWxlbWVudEJpbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5faGFuZGxlRGVsZXRlQnV0dG9uKHRoaXMuX2lkKTtcbiAgICB9KTtcbiAgICB0aGlzLl9saWtlQnV0dG9uID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRfX2J1dHRvblwiKTtcbiAgICB0aGlzLl9saWtlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7IHRoaXMuX2hhbmRsZUxpa2VCdXR0b24odGhpcy5faWQpXG4gICAgfSk7XG4gICAgdGhpcy5fZWxlbWVudFBpY3R1cmUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMuX2hhbmRsZUNhcmRDbGljayh0aGlzLl9uYW1lLCB0aGlzLl9saW5rKTtcbiAgICB9KTtcbiAgfTtcblxuICBnZW5lcmF0ZUNhcmQgPSAoKSA9PiB7XG4gICAgdGhpcy5fZWxlbWVudCA9IHRoaXMuX2dldFRlbXBsYXRlKCk7XG4gICAgdGhpcy5fbGlrZUJ1dHRvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X19idXR0b25cIik7XG4gICAgdGhpcy5fZWxlbWVudFBpY3R1cmUgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudF9fcGljdHVyZVwiKTtcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xuICAgIHRoaXMuX2VsZW1lbnRQaWN0dXJlLnNyYyA9IHRoaXMuX2xpbms7XG4gICAgdGhpcy5fZWxlbWVudFBpY3R1cmUuYWx0ID0gYFBob3RvIG9mICR7dGhpcy5fbmFtZX1gO1xuICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X19oZWFkZXJcIikudGV4dENvbnRlbnQgPSB0aGlzLl9uYW1lO1xuICAgIGlmICh0aGlzLl9vd25lcklkICE9PSB0aGlzLl91c2VySWQpIHtcbiAgICAgIHRoaXMuX2VsZW1lbnRCaW4gPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudF9fYmluXCIpLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIn07ICAgIFxuICAgICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRfX2J1dHRvbi1jb3VudGVyXCIpLnRleHRDb250ZW50ID0gdGhpcy5fbGlrZXMubGVuZ3RoO1xuXG4gICAgIGlmKHRoaXMuaXNMaWtlZCkge1xuICAgICAgdGhpcy5saWtlQ2FyZCh0aGlzLl9saWtlcyk7XG4gICAgIH1cblxuICAgIHJldHVybiB0aGlzLl9lbGVtZW50O1xuICB9O1xufVxuXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cCB7XG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcbiAgICB0aGlzLl9wb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocG9wdXBTZWxlY3Rvcik7XG4gIH1cbiAgb3BlbigpIHtcbiAgICB0aGlzLl9wb3B1cC5jbGFzc0xpc3QuYWRkKFwicG9wdXBfb3BlblwiKTtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NhcGVDbG9zZSk7XG4gIH1cblxuICBjbG9zZSA9ICgpID0+IHtcbiAgICB0aGlzLl9wb3B1cC5jbGFzc0xpc3QucmVtb3ZlKFwicG9wdXBfb3BlblwiKTtcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NhcGVDbG9zZSk7XG4gIH07XG5cbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5fcG9wdXAuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCAoZSkgPT4ge1xuICAgICAgaWYgKFxuICAgICAgICBlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJwb3B1cF9vcGVuXCIpIHx8XG4gICAgICAgIGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInBvcHVwX19jbG9zZVwiKVxuICAgICAgKSB7XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIF9oYW5kbGVFc2NhcGVDbG9zZSA9IChlKSA9PiB7XG4gICAgaWYgKGUua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfVxuICB9O1xufVxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwXCI7XG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhGb3JtIGV4dGVuZHMgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yLCBoYW5kbGVTdWJtaXQpIHtcbiAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcbiAgICB0aGlzLl9oYW5kbGVTdWJtaXQgPSBoYW5kbGVTdWJtaXQ7XG4gICAgdGhpcy5fZm9ybSA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Zvcm1cIik7XG4gIH1cbiAgX2dldElucHV0VmFsdWVzKCkge1xuICAgIGNvbnN0IGlucHV0VmFsdWVzID0ge307XG4gICAgY29uc3QgaW5wdXRzID0gWy4uLnRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvckFsbChcIi5wb3B1cF9faW5wdXRcIildO1xuICAgIGlucHV0cy5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgICAgaW5wdXRWYWx1ZXNbaW5wdXQubmFtZV0gPSBpbnB1dC52YWx1ZTtcbiAgICB9KTtcbiAgICByZXR1cm4gaW5wdXRWYWx1ZXM7XG4gIH1cblxuICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLl9mb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMuX2hhbmRsZVN1Ym1pdCh0aGlzLl9nZXRJbnB1dFZhbHVlcygpKTtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9KTtcbiAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xuICB9XG5cbiAgY2xvc2UoKSB7XG4gICAgdGhpcy5fZm9ybS5yZXNldCgpO1xuICAgIHN1cGVyLmNsb3NlKCk7XG4gIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlY3Rpb24ge1xuICBjb25zdHJ1Y3Rvcih7IGl0ZW1zLCByZW5kZXJlciB9LCBjb250YWluZXJTZWxlY3Rvcikge1xuICAgIHRoaXMuX2l0ZW1zID0gaXRlbXM7XG4gICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjtcbiAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcbiAgfVxuXG4gIGFkZEl0ZW0oZWxlbWVudCkge1xuICAgIHRoaXMuX2NvbnRhaW5lci5wcmVwZW5kKGVsZW1lbnQpO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIHRoaXMuX2l0ZW1zLmZvckVhY2goKGRhdGEpID0+IHtcbiAgICAgIHRoaXMuX3JlbmRlcmVyKGRhdGEpO1xuICAgIH0pO1xuICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBGb3JtVmFsaWRhdG9yIHtcbiAgY29uc3RydWN0b3Ioc2V0dGluZ3MsIGZvcm1FbGVtZW50KSB7XG4gICAgdGhpcy5faW5wdXRTZWxlY3RvciA9IHNldHRpbmdzLmlucHV0U2VsZWN0b3I7XG4gICAgdGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3IgPSBzZXR0aW5ncy5zdWJtaXRCdXR0b25TZWxlY3RvcjtcbiAgICB0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzID0gc2V0dGluZ3MuaW5hY3RpdmVCdXR0b25DbGFzcztcbiAgICB0aGlzLl9pbnB1dEVycm9yQ2xhc3MgPSBzZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3M7XG4gICAgdGhpcy5fZXJyb3JDbGFzcyA9IHNldHRpbmdzLmVycm9yQ2xhc3M7XG4gICAgdGhpcy5fZm9ybUVsZW1lbnQgPSBmb3JtRWxlbWVudDtcbiAgICB0aGlzLl9lbGVtZW50QnV0dG9uID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvblNlbGVjdG9yXG4gICAgKTtcbiAgfVxuXG4gIF9zaG93SW5wdXRFcnJvciA9IChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICB0aGlzLl9lcnJvckVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgYC4ke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgXG4gICAgKTtcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpO1xuICAgIHRoaXMuX2Vycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZTtcbiAgICB0aGlzLl9lcnJvckVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9lcnJvckNsYXNzKTtcbiAgfTtcblxuICBfaGlkZUlucHV0RXJyb3IgPSAoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgdGhpcy5fZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIGAuJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYFxuICAgICk7XG4gICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5wdXRFcnJvckNsYXNzKTtcbiAgICB0aGlzLl9lcnJvckVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9lcnJvckNsYXNzKTtcbiAgICB0aGlzLl9lcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xuICB9O1xuXG4gIF9jaGVja0lucHV0VmFsaWRpdHkgPSAoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcbiAgICAgIHRoaXMuX3Nob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCk7XG4gICAgfVxuICB9O1xuXG4gIF9oYXNJbnZhbGlkSW5wdXQgPSAoaW5wdXRzTGlzdCkgPT4ge1xuICAgIGNvbnN0IGlucHV0cyA9IEFycmF5LmZyb20oaW5wdXRzTGlzdCk7XG4gICAgcmV0dXJuIGlucHV0cy5zb21lKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICAgIHJldHVybiAhaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkO1xuICAgIH0pO1xuICB9O1xuXG4gIF90b2dnbGVCdXR0b25TdGF0ZSA9ICgpID0+IHtcbiAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KHRoaXMuX2lucHV0c0xpc3QpKSB7XG4gICAgICB0aGlzLl9lbGVtZW50QnV0dG9uLmNsYXNzTGlzdC5hZGQodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgICB0aGlzLl9lbGVtZW50QnV0dG9uLnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIHRydWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9lbGVtZW50QnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgICB0aGlzLl9lbGVtZW50QnV0dG9uLnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpO1xuICAgIH1cbiAgfTtcblxuICBfc2V0RXZlbnRMaXN0ZW5lcnMgPSAoKSA9PiB7XG4gICAgdGhpcy5faW5wdXRzTGlzdCA9IEFycmF5LmZyb20oXG4gICAgICB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX2lucHV0U2VsZWN0b3IpXG4gICAgKTtcbiAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSgpO1xuICAgIHRoaXMuX2lucHV0c0xpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCk7XG4gICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfTtcblxuICBlbmFibGVWYWxpZGF0aW9uID0gKCkgPT4ge1xuICAgIHRoaXMuX2Zvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfSk7XG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgfTtcblxuICByZXNldFZhbGlkYXRpb24gPSAoKSA9PiB7XG4gICAgdGhpcy5faW5wdXRzTGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCk7XG4gICAgfSk7XG4gICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoKTtcbiAgfTtcbn1cbiIsImV4cG9ydCB7IHBhZ2VTZXR0aW5ncyB9O1xuXG4vKmNvbnN0IGluaXRpYWxDYXJkcyA9IFtcbiAge1xuICAgIG5hbWU6IFwiWW9zZW1pdGUgVmFsbGV5XCIsXG4gICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS95b3NlbWl0ZS5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiTGFrZSBMb3Vpc2VcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL2xha2UtbG91aXNlLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJCYWxkIE1vdW50YWluc1wiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvYmFsZC1tb3VudGFpbnMuanBnXCIsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIkxhdGVtYXJcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL2xhdGVtYXIuanBnXCIsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIlZhbm9pc2UgTmF0aW9uYWwgUGFya1wiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvdmFub2lzZS5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiTGFnbyBkaSBCcmFpZXNcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL2xhZ28uanBnXCIsXG4gIH0sXG5dO1xuKi9cbmNvbnN0IHBhZ2VTZXR0aW5ncyA9IHtcbiAgZm9ybVNlbGVjdG9yOiBcIi5wb3B1cF9fZm9ybVwiLFxuICBpbnB1dFNlbGVjdG9yOiBcIi5wb3B1cF9faW5wdXRcIixcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLnBvcHVwX19idXR0b25cIixcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJwb3B1cF9fYnV0dG9uX2Rpc2FibGVkXCIsXG4gIGlucHV0RXJyb3JDbGFzczogXCJwb3B1cF9faW5wdXRfdHlwZV9lcnJvclwiLFxuICBlcnJvckNsYXNzOiBcInBvcHVwX19lcnJvcl92aXNpYmxlXCIsXG59O1xuXG4iLCJjb25zdCBjdXN0b21GZXRjaCA9ICh1cmwsIGhlYWRlcnMpID0+IFxuZmV0Y2godXJsLCBoZWFkZXJzKVxuLnRoZW4ocmVzID0+IHJlcy5vayA/IHJlcy5qc29uKCkgOiBQcm9taXNlLnJlamVjdChyZXMuc3RhdHVzVGV4dCkpXG4uY2F0Y2goY29uc29sZS5sb2cpXG5cbmNsYXNzIEFwaSB7XG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XG4gICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmw7XG4gICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XG4gIH1cblxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgcmV0dXJuIGN1c3RvbUZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwgeyBcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnNcbiAgICAgfSlcbiAgfVxuXG4gIGdldFVzZXJJbmZvKCkge1xuICAgIHJldHVybiBjdXN0b21GZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHsgXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzXG4gICAgIH0pXG4gIH1cblxuICBjcmVhdGVDYXJkKHtuYW1lLCBsaW5rfSkge1xuICAgIHJldHVybiBjdXN0b21GZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHsgXG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGxpbmtcbiAgICAgIH0pXG4gICAgIH0pXG4gIH1cblxuICBkZWxldGVDYXJkKGNhcmRJZCkge1xuICAgIHJldHVybiBjdXN0b21GZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH1gLCB7IFxuICAgICAgbWV0aG9kOiAnREVMRVRFJyxcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgIH0pXG4gIH1cblxuICBsaWtlQ2FyZChjYXJkSWQpIHtcbiAgICByZXR1cm4gY3VzdG9tRmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCwgeyBcbiAgICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICB9KVxuICB9XG5cbiAgZGlzbGlrZUNhcmQoY2FyZElkKSB7XG4gICAgcmV0dXJuIGN1c3RvbUZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzL2xpa2VzLyR7Y2FyZElkfWAsIHsgXG4gICAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgfSlcbiAgfVxufVxuXG5leHBvcnQgY29uc3QgYXBpID0gbmV3IEFwaSh7XG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9ncm91cC0xMlwiLFxuICBoZWFkZXJzOiB7XG4gICAgYXV0aG9yaXphdGlvbjogXCIzMmI5ZWZhMC02ZjM1LTRhZmUtOTc1ZS1lM2E2YmU0M2NmY2JcIixcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgfSxcbn0pO1xuIiwiaW1wb3J0IFwiLi4vcGFnZXMvaW5kZXguY3NzXCI7XG5pbXBvcnQgQ2FyZCBmcm9tIFwiLi4vc2NyaXB0cy9jb21wb25lbnRzL0NhcmRcIjtcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tIFwiLi4vc2NyaXB0cy9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlXCI7XG5pbXBvcnQgUG9wdXBXaXRoRm9ybSBmcm9tIFwiLi4vc2NyaXB0cy9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm1cIjtcbmltcG9ydCBVc2VySW5mbyBmcm9tIFwiLi4vc2NyaXB0cy9jb21wb25lbnRzL1VzZXJJbmZvXCI7XG5pbXBvcnQgU2VjdGlvbiBmcm9tIFwiLi4vc2NyaXB0cy9jb21wb25lbnRzL1NlY3Rpb25cIjtcbmltcG9ydCBGb3JtVmFsaWRhdG9yIGZyb20gXCIuLi9zY3JpcHRzL2NvbXBvbmVudHMvRnJvbVZhbGlkYXRvclwiO1xuaW1wb3J0IFBvcHVwV2l0aFN1Ym1pdCBmcm9tIFwiLi4vc2NyaXB0cy9jb21wb25lbnRzL1BvcHVwV2l0aFN1Ym1pdFwiO1xuaW1wb3J0IHsgcGFnZVNldHRpbmdzIH0gZnJvbSBcIi4uL3NjcmlwdHMvdXRpbHMvY29uc3RhbnRzXCI7XG5pbXBvcnQgeyBhcGkgfSBmcm9tIFwiLi4vc2NyaXB0cy9jb21wb25lbnRzL0FwaVwiO1xuXG5jb25zdCBwbHVzUHJvZmlsZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fcGx1c1wiKTtcbmNvbnN0IHByb2ZpbGVGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fZm9ybVwiKTtcbmNvbnN0IGVkaXRQcm9maWxlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0XCIpO1xuY29uc3QgY2FyZEZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtX3NlY29uZFwiKTtcbmNvbnN0IGVsZW1lbnRMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50c19fbGlzdFwiKTtcbmNvbnN0IHByb2ZpbGVJbnB1dE5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19pbnB1dC1uYW1lXCIpO1xuY29uc3QgcHJvZmlsZUlucHV0QWJvdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19pbnB1dC1hYm91dFwiKTtcbmxldCB1c2VySWQ7XG5cbmltcG9ydCBoZWFkZXJTcmMgZnJvbSBcIi4uL2ltYWdlcy9oZWFkZXIuc3ZnXCI7XG5jb25zdCBoZWFkZXJJbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYXJvdW5kLXRoZS11c1wiKTtcbmhlYWRlckltYWdlLnNyYyA9IGhlYWRlclNyYztcblxuaW1wb3J0IHByb2ZpbGVTcmMgZnJvbSBcIi4uL2ltYWdlcy9Db3VzdGVhdS5wbmdcIjtcbmNvbnN0IHByb2ZpbGVJbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicHJvZmlsZS1pbWFnZVwiKTtcbnByb2ZpbGVJbWFnZS5zcmMgPSBwcm9maWxlU3JjO1xuXG5jb25zdCBjYXJkRm9ybVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKHBhZ2VTZXR0aW5ncywgY2FyZEZvcm0pO1xuY2FyZEZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuXG5jb25zdCBwcm9maWxlRm9ybVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKHBhZ2VTZXR0aW5ncywgcHJvZmlsZUZvcm0pO1xucHJvZmlsZUZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuXG5jb25zdCBjb25maXJtTW9kYWwgPSBuZXcgUG9wdXBXaXRoU3VibWl0KFwiLnBvcHVwX2NhcmRfcmVtb3ZlclwiKTtcbmNvbmZpcm1Nb2RhbC5zZXRFdmVudExpc3RlbmVycygpO1xuXG5jb25zdCBpbWFnZU1vZGFsID0gbmV3IFBvcHVwV2l0aEltYWdlKFwiLnBvcHVwX2JpZ19pbWFnZVwiKTtcbmltYWdlTW9kYWwuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuY29uc3QgZWRpdE1vZGFsID0gbmV3IFBvcHVwV2l0aEZvcm0oXCIucG9wdXBfcHJvZmlsZV9hZGRlclwiLCAoZGF0YSkgPT4ge1xuICB1c2VySW5mby5zZXRVc2VySW5mbyhkYXRhKTtcbn0pO1xuZWRpdE1vZGFsLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbmNvbnN0IGFkZENhcmRNb2RhbCA9IG5ldyBQb3B1cFdpdGhGb3JtKFwiLnBvcHVwX2NhcmRfcHVibGlzaGVyXCIsIChkYXRhKSA9PiB7XG4gIGFwaS5jcmVhdGVDYXJkKHsgbmFtZTogZGF0YS5kZXNjcmlwdGlvbiwgbGluazogZGF0YS5saW5rIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgIHJlbmRlckNhcmQocmVzKTtcbiAgfSk7XG59KTtcbmFkZENhcmRNb2RhbC5zZXRFdmVudExpc3RlbmVycygpO1xuXG5jb25zdCByZW5kZXJDYXJkID0gKGRhdGEpID0+IHtcbiAgY29uc3QgY2FyZCA9IGNyZWF0ZU5ld0NhcmQoZGF0YSk7XG4gIGVsZW1lbnRMaXN0LnByZXBlbmQoY2FyZCk7XG59O1xuXG5hcGkuZ2V0VXNlckluZm8oKS50aGVuKChyZXMpID0+IHtcbiAgdXNlcklkID0gcmVzLl9pZDtcbiAgdXNlckluZm8uc2V0VXNlckluZm8oeyBuYW1lOiByZXMubmFtZSwgYWJvdXQ6IHJlcy5hYm91dCB9KTtcbn0pO1xuXG5hcGkuZ2V0SW5pdGlhbENhcmRzKCkudGhlbigocmVzKSA9PiB7XG4gIGNvbnNvbGUubG9nKFwicmVzXCIsIHJlcyk7XG4gIGNvbnN0IHNlY3Rpb24gPSBuZXcgU2VjdGlvbihcbiAgICB7XG4gICAgICBpdGVtczogcmVzLFxuICAgICAgcmVuZGVyZXI6IHJlbmRlckNhcmQsXG4gICAgfSxcbiAgICBcIi5lbGVtZW50c19fbGlzdFwiXG4gICk7XG4gIHNlY3Rpb24ucmVuZGVyKCk7XG59KTtcblxuY29uc3QgdXNlckluZm8gPSBuZXcgVXNlckluZm8oe1xuICBwcm9maWxlTmFtZVNlbGVjdG9yOiBcIi5wcm9maWxlX19hdXRob3JcIixcbiAgcHJvZmlsZUpvYlNlbGVjdG9yOiBcIi5wcm9maWxlX190ZXh0XCIsXG59KTtcblxuZnVuY3Rpb24gY3JlYXRlTmV3Q2FyZChkYXRhKSB7XG4gIGNvbnN0IGNhcmQgPSBuZXcgQ2FyZChcbiAgICB7XG4gICAgICBkYXRhLFxuICAgICAgaGFuZGxlQ2FyZENsaWNrOiAobmFtZSwgbGluaykgPT4ge1xuICAgICAgICBpbWFnZU1vZGFsLm9wZW4obmFtZSwgbGluayk7XG4gICAgICB9LFxuICAgICAgaGFuZGxlRGVsZXRlQnV0dG9uOiAoaWQpID0+IHtcbiAgICAgICAgY29uZmlybU1vZGFsLm9wZW4oKTtcblxuICAgICAgICBjb25maXJtTW9kYWwuc2V0QWN0aW9uKCgpID0+IHtcbiAgICAgICAgICBhcGkuZGVsZXRlQ2FyZChpZCkudGhlbigocmVzKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlRoaXMgY2FyZCB3YXMgZGVsZXRlZFwiLCByZXMpO1xuICAgICAgICAgICAgY2FyZC5yZW1vdmVDYXJkKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIGhhbmRsZUxpa2VCdXR0b246IChpZCkgPT4ge1xuICAgICAgICBjb25zdCBpc0FscmVhZHlMaWtlZCA9IGNhcmQuaXNMaWtlZCgpO1xuICAgICAgICBpZiAoaXNBbHJlYWR5TGlrZWQpIHtcbiAgICAgICAgICBhcGkuZGlzbGlrZUNhcmQoaWQpLnRoZW4oKHJlcykgPT4ge1xuICAgICAgICAgICAgY2FyZC5saWtlQ2FyZChyZXMubGlrZXMpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFwaS5saWtlQ2FyZChpZCkudGhlbigocmVzKSA9PiB7XG4gICAgICAgICAgICBjYXJkLmxpa2VDYXJkKHJlcy5saWtlcyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgfSxcbiAgICB1c2VySWQsXG4gICAgXCIjY2FyZC10ZW1wbGF0ZVwiXG4gICk7XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZC5nZW5lcmF0ZUNhcmQoKTtcbiAgcmV0dXJuIGNhcmRFbGVtZW50O1xufVxuXG5mdW5jdGlvbiBmaWxsUHJvZmlsZUZvcm0oKSB7XG4gIGNvbnN0IHVzZXJEYXRhID0gdXNlckluZm8uZ2V0VXNlckluZm8oKTtcbiAgcHJvZmlsZUlucHV0TmFtZS52YWx1ZSA9IHVzZXJEYXRhLm5hbWU7XG4gIHByb2ZpbGVJbnB1dEFib3V0LnZhbHVlID0gdXNlckRhdGEuam9iO1xufVxuXG5lZGl0UHJvZmlsZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBwcm9maWxlRm9ybVZhbGlkYXRvci5yZXNldFZhbGlkYXRpb24ocHJvZmlsZUZvcm0pO1xuICBmaWxsUHJvZmlsZUZvcm0oKTtcbiAgZWRpdE1vZGFsLm9wZW4oKTtcbn0pO1xuXG5wbHVzUHJvZmlsZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBjYXJkRm9ybVZhbGlkYXRvci5yZXNldFZhbGlkYXRpb24oY2FyZEZvcm0pO1xuICBhZGRDYXJkTW9kYWwub3BlbigpO1xufSk7XG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXBcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoU3VibWl0IGV4dGVuZHMgUG9wdXAge1xuc2V0QWN0aW9uKGFjdGlvbikge1xudGhpcy5fc3VibWl0SGFuZGxlciA9IGFjdGlvblxudGhpcy5fZm9ybSA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Zvcm1cIik7XG59XG4gICAgXG5fZ2V0SW5wdXRWYWx1ZXMoKSB7XG4gICAgY29uc3QgaW5wdXRWYWx1ZXMgPSB7fTtcbiAgICBjb25zdCBpbnB1dHMgPSBbLi4udGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yQWxsKFwiLnBvcHVwX19pbnB1dFwiKV07XG4gICAgaW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICBpbnB1dFZhbHVlc1tpbnB1dC5uYW1lXSA9IGlucHV0LnZhbHVlO1xuICAgIH0pO1xuICAgIHJldHVybiBpbnB1dFZhbHVlcztcbiAgfVxuXG5zZXRFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLl9wb3B1cC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChlKSA9PiB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB0aGlzLl9zdWJtaXRIYW5kbGVyKHRoaXMuX2dldElucHV0VmFsdWVzKCkpO1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH0pO1xuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gIH1cbn0iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXBcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoSW1hZ2UgZXh0ZW5kcyBQb3B1cCB7XG4gIG9wZW4obmFtZSwgbGluaykge1xuICAgIGNvbnN0IGltYWdlID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9faW1hZ2VcIik7XG4gICAgY29uc3QgY2FwdGlvbiA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Rlc2NyaXB0aW9uXCIpO1xuICAgIGNhcHRpb24udGV4dENvbnRlbnQgPSBuYW1lO1xuICAgIGltYWdlLmFsdCA9IGBQaG90byBvZiAke25hbWV9YDtcbiAgICBpbWFnZS5zcmMgPSBsaW5rO1xuICAgIHN1cGVyLm9wZW4oKTtcbiAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgVXNlckluZm8ge1xuICBjb25zdHJ1Y3Rvcih7IHByb2ZpbGVOYW1lU2VsZWN0b3IsIHByb2ZpbGVKb2JTZWxlY3RvciB9KSB7XG4gICAgdGhpcy5fcHJvZmlsZU5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHByb2ZpbGVOYW1lU2VsZWN0b3IpO1xuICAgIHRoaXMuX3Byb2ZpbGVKb2IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHByb2ZpbGVKb2JTZWxlY3Rvcik7XG4gIH1cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IHRoaXMuX3Byb2ZpbGVOYW1lLnRleHRDb250ZW50LFxuICAgICAgam9iOiB0aGlzLl9wcm9maWxlSm9iLnRleHRDb250ZW50LFxuICAgIH07XG4gIH1cbiAgc2V0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XG4gICAgdGhpcy5fcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSBuYW1lO1xuICAgIHRoaXMuX3Byb2ZpbGVKb2IudGV4dENvbnRlbnQgPSBhYm91dDtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsInVuZGVmaW5lZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwicCIsIkNhcmQiLCJjb25zdHJ1Y3RvciIsInVzZXJJZCIsImNhcmRTZWxlY3RvciIsImRhdGEiLCJoYW5kbGVDYXJkQ2xpY2siLCJoYW5kbGVEZWxldGVCdXR0b24iLCJoYW5kbGVMaWtlQnV0dG9uIiwidGhpcyIsIl9lbGVtZW50IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiX2NhcmRTZWxlY3RvciIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJyZW1vdmUiLCJfZWxlbWVudEJpbiIsImFkZEV2ZW50TGlzdGVuZXIiLCJfaGFuZGxlRGVsZXRlQnV0dG9uIiwiX2lkIiwiX2xpa2VCdXR0b24iLCJfaGFuZGxlTGlrZUJ1dHRvbiIsIl9lbGVtZW50UGljdHVyZSIsIl9oYW5kbGVDYXJkQ2xpY2siLCJfbmFtZSIsIl9saW5rIiwiX2dldFRlbXBsYXRlIiwiX3NldEV2ZW50TGlzdGVuZXJzIiwic3JjIiwiYWx0IiwidGV4dENvbnRlbnQiLCJfb3duZXJJZCIsIl91c2VySWQiLCJzdHlsZSIsImRpc3BsYXkiLCJfbGlrZXMiLCJsZW5ndGgiLCJpc0xpa2VkIiwibGlrZUNhcmQiLCJuYW1lIiwibGluayIsIm93bmVyIiwibGlrZXMiLCJuZXdMaWtlcyIsImNsYXNzTGlzdCIsInRvZ2dsZSIsInNvbWUiLCJwZXJzb24iLCJQb3B1cCIsInBvcHVwU2VsZWN0b3IiLCJfcG9wdXAiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiX2hhbmRsZUVzY2FwZUNsb3NlIiwiZSIsImtleSIsImNsb3NlIiwib3BlbiIsImFkZCIsInNldEV2ZW50TGlzdGVuZXJzIiwidGFyZ2V0IiwiY29udGFpbnMiLCJQb3B1cFdpdGhGb3JtIiwiaGFuZGxlU3VibWl0Iiwic3VwZXIiLCJfaGFuZGxlU3VibWl0IiwiX2Zvcm0iLCJfZ2V0SW5wdXRWYWx1ZXMiLCJpbnB1dFZhbHVlcyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiaW5wdXQiLCJ2YWx1ZSIsInByZXZlbnREZWZhdWx0IiwicmVzZXQiLCJTZWN0aW9uIiwiY29udGFpbmVyU2VsZWN0b3IiLCJpdGVtcyIsInJlbmRlcmVyIiwiX2l0ZW1zIiwiX3JlbmRlcmVyIiwiX2NvbnRhaW5lciIsImFkZEl0ZW0iLCJlbGVtZW50IiwicHJlcGVuZCIsInJlbmRlciIsIkZvcm1WYWxpZGF0b3IiLCJzZXR0aW5ncyIsImZvcm1FbGVtZW50IiwiaW5wdXRFbGVtZW50IiwiX2Vycm9yRWxlbWVudCIsIl9mb3JtRWxlbWVudCIsImlkIiwiX2lucHV0RXJyb3JDbGFzcyIsInZhbGlkYXRpb25NZXNzYWdlIiwiX2Vycm9yQ2xhc3MiLCJ2YWxpZGl0eSIsInZhbGlkIiwiX2hpZGVJbnB1dEVycm9yIiwiX3Nob3dJbnB1dEVycm9yIiwiaW5wdXRzTGlzdCIsIkFycmF5IiwiZnJvbSIsIl9oYXNJbnZhbGlkSW5wdXQiLCJfaW5wdXRzTGlzdCIsIl9lbGVtZW50QnV0dG9uIiwiX2luYWN0aXZlQnV0dG9uQ2xhc3MiLCJzZXRBdHRyaWJ1dGUiLCJyZW1vdmVBdHRyaWJ1dGUiLCJfaW5wdXRTZWxlY3RvciIsIl90b2dnbGVCdXR0b25TdGF0ZSIsIl9jaGVja0lucHV0VmFsaWRpdHkiLCJldnQiLCJpbnB1dFNlbGVjdG9yIiwiX3N1Ym1pdEJ1dHRvblNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsInBhZ2VTZXR0aW5ncyIsImZvcm1TZWxlY3RvciIsImN1c3RvbUZldGNoIiwidXJsIiwiaGVhZGVycyIsImZldGNoIiwidGhlbiIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXNUZXh0IiwiY2F0Y2giLCJjb25zb2xlIiwibG9nIiwiYXBpIiwiYmFzZVVybCIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJnZXRJbml0aWFsQ2FyZHMiLCJnZXRVc2VySW5mbyIsImNyZWF0ZUNhcmQiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImRlbGV0ZUNhcmQiLCJjYXJkSWQiLCJkaXNsaWtlQ2FyZCIsImF1dGhvcml6YXRpb24iLCJwbHVzUHJvZmlsZUJ1dHRvbiIsInByb2ZpbGVGb3JtIiwiZWRpdFByb2ZpbGVCdXR0b24iLCJjYXJkRm9ybSIsImVsZW1lbnRMaXN0IiwicHJvZmlsZUlucHV0TmFtZSIsInByb2ZpbGVJbnB1dEFib3V0IiwiZ2V0RWxlbWVudEJ5SWQiLCJoZWFkZXJTcmMiLCJwcm9maWxlU3JjIiwiY2FyZEZvcm1WYWxpZGF0b3IiLCJlbmFibGVWYWxpZGF0aW9uIiwicHJvZmlsZUZvcm1WYWxpZGF0b3IiLCJjb25maXJtTW9kYWwiLCJzZXRBY3Rpb24iLCJhY3Rpb24iLCJfc3VibWl0SGFuZGxlciIsImltYWdlTW9kYWwiLCJpbWFnZSIsImVkaXRNb2RhbCIsInVzZXJJbmZvIiwic2V0VXNlckluZm8iLCJhZGRDYXJkTW9kYWwiLCJkZXNjcmlwdGlvbiIsInJlbmRlckNhcmQiLCJjYXJkIiwicmVtb3ZlQ2FyZCIsImdlbmVyYXRlQ2FyZCIsImNyZWF0ZU5ld0NhcmQiLCJhYm91dCIsInByb2ZpbGVOYW1lU2VsZWN0b3IiLCJwcm9maWxlSm9iU2VsZWN0b3IiLCJfcHJvZmlsZU5hbWUiLCJfcHJvZmlsZUpvYiIsImpvYiIsInJlc2V0VmFsaWRhdGlvbiIsInVzZXJEYXRhIiwiZmlsbFByb2ZpbGVGb3JtIl0sInNvdXJjZVJvb3QiOiIifQ==